<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
  <style>
    span {
      padding-left: 10px;
      padding-right: 10px;
    }

    table {
      width: 100%;
    }

    td {
      border: 1px solid #000
    }

    .box {
      position: absolute;
      left: 400px;
      background-color: #f00;
      width: 400px;
      height: 400px;
      box-shadow: 100px 100px 30px 100px rgba(0,0,0,.1);
    }
  </style>
  <script>
    window.onload = function () {
      var boxes = document.querySelectorAll('div');
      document.body.onmouseup = function () {
        setTimeout(function () {
          var selection = document.getSelection();
          var rawRange = selection.getRangeAt(0);
          console.log(rawRange);
          selection.removeAllRanges();

          // var range = document.createRange();
          // var node = boxes[0].childNodes[0];
          // range.setStart(node, 0);
          // range.setEnd(node, node.textContent.length);
          // selection.addRange(range);

          var range2 = document.createRange();

          range2.selectNodeContents(boxes[0].childNodes[3]);
          selection.addRange(range2);

          // range.selectNodeContents(boxes[1]);
          // selection.addRange(range.cloneRange());
          //
          // range.selectNodeContents(boxes[2]);
          // range.setStartBefore(boxes[2]);
          // selection.addRange(range.cloneRange());
          //
          // range.selectNodeContents(boxes[3]);
          // range.setEndAfter(boxes[3]);
          // selection.addRange(range.cloneRange());
          // console.log(range);
        }, 200);
      }
    }
  </script>
</head>
<body contenteditable>
tuyityui
<p>
  <strong>aaabbbaaa</strong>
  <strong><strong>aaa</strong>bbb<strong>aaa</strong></strong>
  <strong>aaa</strong>bbb<strong>aaa</strong>
</p>

<div>4444
  <p>111</p>
  <p>222</p>
  <p>333</p>
  <p>444</p>
</div>
<div class="box"></div>
</body>
</html>
